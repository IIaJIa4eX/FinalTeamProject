@model IEnumerable<DatabaseConnector.Post>
@{
    ViewData["Title"] = "Home";
}

<div class="MainBody">
    <div class="CategoriesInIndex d-flex justify-content-center">
        <ul class="list-group list-group-horizontal">
            <li class="list-group-item"><a type="button" asp-controller="Home" asp-action="Index" asp-route-category="IT">IT</a></li>
            <li class="list-group-item"><a type="button" asp-controller="Home" asp-action="Index" asp-route-category="Marketing">Marketing</a></li>
            <li class="list-group-item"><a type="button" asp-controller="Home" asp-action="Index" asp-route-category="Design">Design</a></li>
            <li class="list-group-item"><a type="button" asp-controller="Home" asp-action="Index" asp-route-category="Mobile Development">Mobile Development</a></li>
        </ul>
    </div>
</div>
<div class="">
    <div сlass="" id="posts-container">
        @foreach (var item in Model)
        {
            <partial name="~/Views/PartialPost.cshtml" model=@item />
            @*<a type="button" class="text-decoration-none" asp-controller="Post" asp-action="Index"  asp-route-id="@item.Id">
                <div class="uk-card uk-card-default uk-grid-collapse uk-child-width-1-2@s uk-margin" uk-grid>
                    <div class="uk-card-media-left uk-cover-container">
                        <img src="~/imgs/examplephoto.jpeg" alt="" uk-cover>
                        <canvas width="600" height="400"></canvas>
                    </div>
                    <div>
                        <div class="uk-card-body">
                            <div class="uk-card-badge uk-label">@item.Category</div>
                            <div class="uk-width-1-2">
                                <img class="uk-border-circle" width="40" height="40" src="~/imgs/exampleprofilephoto.jpeg" alt="Avatar" >
                                <h2 style="background-color:darkcyan; border-radius: 199px; width: 43px; height: 43px; text-align:center;">
                                    👨‍💻
                                </h2>
                            </div>
                            <div class="uk-width-1-2">
                                <h3 class="uk-card-title uk-margin-remove-bottom">@item.User.NickName</h3>
                                <p class="uk-text-meta uk-margin-remove-top"><time datetime="2023-23-23T23:23">@item.CreationDate.ToString()</time></p>
                            </div>
                            <p>@Html.Raw(item.Content.Text)</p>
                        </div>
                    </div>
                    <div class="uk-card-footer">
                        <div class="CardFooter">
                            <div class="Likes">
                                <div>
                                    <img src="~/icons/heart.png" width="20" height="20" />
                                </div>
                                <div>
                                    <p style="text-align:center">@item.Rating.ToString() likes </p>
                                </div>
                            </div>
                            <div class="Comments">
                                <div>
                                    <img src="~/icons/comment.png" width="20" height="20" />
                                </div>
                                <div>
                                    <p style="text-align:center">@item.Comments.Count().ToString() comments </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
            *@
        }
        <div id="loading-indicator"></div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            let loading = false;
            let skip = @Model.Count();
            let take = 10;
            let creationDate = "";
            let category = '@Html.Raw(ViewBag.Category)';
            let container = $('#posts-container');
            let indicator = $('#loading-indicator');
            $(window).scroll(function () {
                if (!loading && $(window).scrollTop() >= $(document).height() - $(window).height() - 100) {
                    loading = true;
                    indicator.show();
                    $.ajax({
                        type: "POST",
                        url: '/Post/GetPosts',
                        data: { creationDate: creationDate, category: category, skip: skip, take: take },
                        success: function (html) {
                            indicator.remove();
                            container.append(html);
                            indicator = $('#loading-indicator');
                            skip += take;
                            loading = false;
                            indicator.hide();
                        }
                    });
                }
            });
        });
    </script>
}