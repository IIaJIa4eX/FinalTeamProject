@model IEnumerable<DatabaseConnector.Post>
@{
    ViewData["Title"] = "Home";
}


<div class="MainBody">
    <div class="CategoriesInIndex d-flex justify-content-center">
        <ul class="list-group list-group-horizontal">
            <li class="list-group-item"><a type="button" asp-controller="Home" asp-action="Index" asp-route-category="IT">IT</a></li>
            <li class="list-group-item"><a type="button" asp-controller="Home" asp-action="Index" asp-route-category="Marketing">Marketing</a></li>
            <li class="list-group-item"><a type="button" asp-controller="Home" asp-action="Index" asp-route-category="Design">Design</a></li>
            <li class="list-group-item"><a type="button" asp-controller="Home" asp-action="Index" asp-route-category="Mobile Development">Mobile Development</a></li>
        </ul>
    </div>
</div>
<div class="PostInMain">
    <div сlass="PostCard" id="posts-container">
        <partial name="/Views/Post/_PostsPartial.cshtml" model="@Model" />
        <div id="loading-indicator"></div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            let loading = false;
            let skip = @Model.Count();
            let take = 10;
            let creationDate = "";
            let category = '@Html.Raw(ViewBag.Category)';
            let container = $('#posts-container');
            let indicator = $('#loading-indicator');
            $(window).scroll(function () {
                if (!loading && $(window).scrollTop() >= $(document).height() - $(window).height() - 100) {
                    loading = true;
                    indicator.show();
                    $.ajax({
                        type: "POST",
                        url: '/Post/GetPosts',
                        data: { creationDate: creationDate, category: category, skip: skip, take: take },
                        success: function (html) {                            
                            indicator.remove();
                            container.append(html);
                            indicator = $('#loading-indicator');
                            skip += take;
                            loading = false;
                            indicator.hide();
                        }
                    });
                }
            });
        });
    </script>
}