@using DatabaseConnector.DTO;
@using DatabaseConnector.DTO.Post;
@model DatabaseConnector.Post

@{
    ContentDTO dtos = new();
    ViewData["Title"] = "Index";
    ViewData["PostId"] = Model.Id;
}
<h1>Post @Model.Id</h1>
<div class="uk-card uk-card-hover uk-card-default uk-child-width-1-1@s uk-margin" uk-grid>
    <div class="uk-card-header">
        <div class="uk-grid-large uk-flex-middle" uk-grid>
            <div class="uk-width-auto">
                <h2 style="background-color:darkcyan; border-radius: 199px; width: 43px; height: 43px; text-align:center;">
                    üë®‚Äçüíª
                </h2>
            </div>
            <div class="uk-width-expand">
                <h3 class="uk-card-title uk-margin-remove-bottom">@Model.User.NickName</h3>
                <p class="uk-text-meta uk-margin-remove-top">@Model.CreationDate.ToString()</p>
            </div>
        </div>
    </div>
    <div>
        <div class="uk-card-body ">
            <div class="uk-card-badge uk-label">@Model.Category</div>
            <div class="uk-overflow-auto">@Html.Raw(Model.Content.Text)</div>
        </div>
    </div>
    <div class="uk-card-footer ">
        <div class="CardFooter uk-width-1-1@s">
            <div class="uk-margin-left uk-width-1-2@s">
                <div class="Likes">
                    <div>
                        <img src="~/icons/heart.png" width="20" height="20" />
                    </div>
                    <div>
                        <p style="text-align:center"> @Model.Rating.ToString() likes </p>
                    </div>
                </div>
                <div class="Comments">
                    <div>
                        <img src="~/icons/comment.png" width="20" height="20" />
                    </div>
                    <div>
                        <p style="text-align:center"> @Model.Comments.Where(i=>i.IsVisible).Count().ToString() comments </p>
                    </div>
                </div>
            </div>
            <div class="uk-button-group uk-margin-right uk-width-1-2@s">
                @if (@User.Identity!.IsAuthenticated)
                {
                    <div>
                            <a class="uk-button uk-button-primary"
                            method="Get"
                        asp-action="PostRating"
                        asp-route-rating="plus"
                        asp-route-id="@Model.Id">
                            Like
                        </a>
                    </div>
                    <div>
                            <a class="uk-button uk-button-danger"
                            method="Get"
                        asp-action="PostRating"
                        asp-route-rating="minus"
                        asp-route-id="@Model.Id">
                            Dislike
                        </a>
                    </div>
                    <div>
                        <form asp-controller="Issue" asp-action="AutoIssue" method="post">
                            <input type="hidden" name="contentText" value="@Model.Id">
                            <input type="hidden" name="issueType" value="1">
                            <button type="submit" class="uk-button uk-button-secondary">–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</button>
                        </form>
                    </div>
                }
                @if (@User.IsInRole("Admin"))
                {
                    <div>
                        <a class="uk-button uk-button-danger" asp-controller="Post" asp-action="HidePost" asp-route-id="@Model.Id">Hide</a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<div>
    @foreach (var item in Model.Comments)
    {
        if (item is not null && item.IsVisible)
        {
            <partial name="CommentPartial" model="item"/>
        }
    }
</div>

<partial name="AddPostComment" model=@dtos/>

